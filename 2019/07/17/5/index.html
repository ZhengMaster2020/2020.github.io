<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="ZhengMaster的博客">
    <meta name="keyword" content="hexo bolg 个人博客">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        深入理解浏览器渲染机制 - ZhengMaster的博客 | Zhengmaster&#39;s Blog
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> Talk is cheap. Show me the code -&gt;  屁话少说，放码过来 </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.jpg">
        </div>
        <div class="name">
            <i>ZhengMaster</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li>
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li>
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li>
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li>
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-浏览器渲染页面的大致流程"><span class="toc-text">1. 浏览器渲染页面的大致流程</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input">
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> Talk is cheap. Show me the code -&gt;  屁话少说，放码过来 </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        深入理解浏览器渲染机制
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2019-07-17 10:50:26</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#浏览器渲染" title="浏览器渲染">浏览器渲染</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>

    </div>
    <div class="post-content ">
        <h3 id="1-浏览器渲染页面的大致流程"><a href="#1-浏览器渲染页面的大致流程" class="headerlink" title="1. 浏览器渲染页面的大致流程"></a>1. 浏览器渲染页面的大致流程</h3><p><img src="http://imweb-io-1251594266.file.myqcloud.com/Fs-4pQMkTCUIeOj0XjSDdZkHzs0N" alt="img not found"></p>
<p>当浏览器从服务器接收到页面的HTML响应时，在屏幕上绘制像素之前需要采取许多步骤。浏览器为页面的初始绘制而需要执行的顺序称为“<strong>关键渲染路径(Critical Rendering Path) CRP</strong>”。浏览器的渲染引擎会执行如下几个步骤来渲染页面，把渲染的页面结果呈现给用户。从上图中可以看到：</p>
<p><strong>1）浏览器会解析三个东西：</strong></p>
<p>一个是HTML/SVG/XHTML，事实上，Webkit有三个C++的类对应这三类文档。解析这三种文件会产生一个DOM Tree。 CSS，解析CSS会产生CSS规则树。 Javascript，脚本，主要是通过DOM API和CSSOM API来操作DOM Tree和CSS Rule Tree.</p>
<p><strong>2）解析完成后，浏览器引擎会通过DOM Tree 和 CSS Rule Tree 来构造 Rendering Tree。</strong></p>
<p>Rendering Tree 渲染树并不等同于DOM树，因为一些像Header或display:none的东西就没必要放在渲染树中了。 CSS 的 Rule Tree主要是为了完成匹配并把CSS Rule附加上Rendering Tree上的每个Element。也就是DOM结点。也就是所谓的Frame。 然后，计算每个Frame（也就是每个Element）的位置，这又叫layout和reflow过程。</p>
<p><strong>3）最后通过调用操作系统Native GUI的API绘制。</strong></p>
<p>更加直观的描述上面过程如下如图所示：</p>
<p><img src="https://bitsofco.de/content/images/2017/01/CRP-Sequence-Copy.png" alt="img not found"></p>
<blockquote>
<ol>
<li>构建DOM Tree</li>
<li>构建CSSOM</li>
<li>构建渲染树</li>
<li>生成布局（回流）</li>
<li>绘制</li>
</ol>
</blockquote>
<ul>
<li><p>构建DOM树</p>
<p>浏览器会将HTML页面文件转换为一颗DOM树，从文件的<html></html>标签开始解析里面的元素以及多层次的嵌套元素。浏览器读取html的原始原始字节，根据指定的编码生成字符串，然后再将字符串解析Tocken（Token要标识“起始标签”和“结束标签”等标识的作用），然后一边生成Token一边消耗Token来生成节点对象最终生成DOM。</p>
<p>如下例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Understanding the Critical Rendering Path<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Understanding the Critical Rendering Path<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Introduction<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Lorem ipsum dolor sit amet<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">small</span>&gt;</span>Copyright 2017<span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最终转换生成的DOM</p>
</li>
</ul>
<p><img src="https://bitsofco.de/content/images/2017/01/DOM.png" alt="img not found"></p>
<p>关于HTML的一件好事是它可以部分执行。无需加载完整的文档即可使内容开始出现在页面上。</p>
<ul>
<li><p><strong>构建CSSOM</strong>  </p>
<p>1、DOM会捕获页面的内容，但浏览器还需要知道页面如何展示，所以需要构建CSSOM。</p>
<p>构建CSSOM的过程与构建DOM的过程非常相似，当浏览器接收到一段CSS，浏览器首先要做的是识别出Token，然后构建节点并生成CSSOM。</p>
<p>2、CSS被视为<strong>“渲染阻止资源</strong>”。这意味着如果不首先完全解析资源，就无法构建渲染树（参见下文）。与HTML不同，由于CSS具有继承级联性质，因此不能部分使用CSS。稍后在文档中定义的样式可以覆盖和更改先前定义的样式。因此，如果在解析整个样式表之前开始使用样式表中较早定义的CSS样式，则可能会遇到应用了错误CSS的情况。这意味着，在我们进入下一阶段之前，必须对CSS进行完全解析。CSS文件仅适用于当前设备，才被视为渲染阻止。&lt;link rel =“ stylesheet”&gt;标记可以接受media属性，在该属性中，我们可以指定适用于其中样式的任何媒体查询。例如，如果我们有一个样式表，其媒体属性为direction：landscape，并且我们正在以纵向模式查看页面，则该资源将不被视为渲染阻止。CSS也可以是“<strong>脚本阻止</strong>”。这是因为JavaScript文件必须等待CSSOM构造完成后才能运行。</p>
<p>3、JavaScript被认为是<strong>“parser blocking resource（解析器阻止资源）”</strong>。这意味着HTML文档本身的解析被JavaScript阻止。当解析器到达<script>标记时，无论是内部标记还是外部标记，它都会停止获取（如果是外部标记）并运行它。这就是为什么，如果我们有一个JavaScript文件引用了文档中的元素，则必须将其放在该文档的外观之后。为了避免JavaScript被解析器阻止，可以通过应用<strong>async</strong>属性异步加载它。<strong>（<a href="https://segmentfault.com/q/1010000000640869">js文件的异步加载 defer 与 async？</a>）</strong></p>
</li>
</ul>
<ul>
<li><p><strong>构建渲染树</strong></p>
<p>当我们生成 DOM 树和 CSSOM 树以后，就需要将这两棵树组合为渲染树。</p>
<p><img src="https://image.fundebug.com/2019-01-03-6.png" alt="img not found"></p>
<ul>
<li><strong>布局与绘制</strong></li>
</ul>
<p>当浏览器生成渲染树以后，就会根据渲染树来进行布局（也可以叫做回流）。这一阶段浏览器要做的事情是要弄清楚各个节点在页面中的确切位置和大小。通常这一行为也被称为“自动重排”。</p>
<p>布局流程的输出是一个“盒模型”，它会精确地捕获每个元素在视口内的确切位置和尺寸，所有相对测量值都将转换为屏幕上的绝对像素。</p>
<p>布局完成后，浏览器会立即发出“Paint Setup”和“Paint”事件，将渲染树转换成屏幕上的像素。</p>
<p>在生成布局的这个过程中会发生<strong>回流</strong>和<strong>重绘</strong>，这是一个非常重要的知识点。</p>
</li>
</ul>
<h3 id="2、页面重绘与回流"><a href="#2、页面重绘与回流" class="headerlink" title="2、页面重绘与回流"></a>2、页面重绘与回流</h3><ul>
<li>什么是重绘，什么是回流？</li>
<li>什么情况下会触发重绘或者回流？</li>
<li>彼此二者的优化方法有哪些？</li>
</ul>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><ul>
<li><a href="https://imweb.io/topic/56841c864c44bcc56092e3fa">浏览器渲染原理</a></li>
</ul>
</script></p></li></ul>
        
        <br>
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://github.com/ZhengMaster2020/ZhengMaster2020.github.io">ZhengMaster</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud"> Pure Theme</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.xml"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
